<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DDrinks - Sistema de Or√ßamentos</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="app.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">
</head>
<body>
<div class="app-container">
  <!-- Header Profissional -->
  <header class="app-header">
    <div class="app-header-content">
      <div class="app-logo">
        <a href="#" class="app-logo-link" aria-label="DDrinks - In√≠cio" onclick="showPage('home');return false;">
          <span class="app-logo-icon" role="img" aria-hidden="true" title="DDrinks">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M4 3h16" stroke="rgba(255,255,255,0.9)" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M7 6l5 6 5-6" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 12v6" stroke="rgba(255,255,255,0.95)" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M9 18h6" stroke="rgba(255,255,255,0.9)" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
          </span>
          <div class="app-logo-text">DDrinks</div>
        </a>
      </div>
      <nav class="app-nav">
        <a href="/agenda" class="btn btn-secondary" aria-label="Agenda">
          <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M3 7h18" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><path d="M8 3v4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><path d="M16 3v4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><rect x="3" y="7" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.2" fill="none"/></svg>Agenda</span>
        </a>
        <a href="/datas" class="btn btn-secondary" aria-label="Calend√°rio">
          <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><rect x="3" y="5" width="18" height="16" rx="2" stroke="currentColor" stroke-width="1.2" fill="none"/><path d="M16 3v4M8 3v4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>Calend√°rio</span>
        </a>
        <button onclick="logout()" class="btn btn-secondary" data-logout aria-label="Sair">
          <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M16 17l5-5-5-5" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 12H9" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M13 19H6a2 2 0 01-2-2V7a2 2 0 012-2h7" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>Sair</span>
        </button>
      </nav>
    </div>
  </header>

  <!-- Formul√°rio de Informa√ß√µes do Cliente -->
  <div class="card mb-8">
    <div class="card-header">
      <h2 class="card-title">üìã Informa√ß√µes do Cliente</h2>
      <p class="card-subtitle">Preencha os dados b√°sicos do evento</p>
    </div>
    
    <form data-validate>
      <div class="grid grid-cols-3 gap-4">
        <div class="form-group">
          <label for="clienteNome" class="form-label">Nome do Cliente *</label>
          <input type="text" id="clienteNome" class="form-input" placeholder="Nome completo do cliente" required />
        </div>
        <div class="form-group">
          <label for="clienteTelefone" class="form-label">Telefone *</label>
          <input type="tel" id="clienteTelefone" class="form-input" placeholder="(11) 99999-9999" required />
        </div>
        <div class="form-group">
          <label for="clienteCidade" class="form-label">Cidade *</label>
          <input type="text" id="clienteCidade" class="form-input" placeholder="Cidade do evento" required />
        </div>
      </div>
      
      <div class="grid grid-cols-3 gap-4">
        <div class="form-group">
          <label for="dataEvento" class="form-label">Data do Evento *</label>
          <input type="date" id="dataEvento" class="form-input" required />
        </div>
        <div class="form-group">
          <label for="quantidadeConvidados" class="form-label">Convidados *</label>
          <input type="number" id="quantidadeConvidados" class="form-input" placeholder="N√∫mero de convidados" min="1" required />
        </div>
        <div class="form-group">
          <label for="descricaoEvento" class="form-label">Descri√ß√£o *</label>
          <input type="text" id="descricaoEvento" class="form-input" placeholder="Tipo de evento" required />
        </div>
      </div>
    </form>
  </div>

  <!-- Sele√ß√£o de Drinks -->
  <div class="card mb-8">
    <div class="card-header">
      <h2 class="card-title">üçπ Sele√ß√£o de Drinks</h2>
      <p class="card-subtitle">Escolha a quantidade de cada drink para o evento</p>
    </div>
    
    <div class="grid grid-cols-4 gap-4">
      <div class="form-group">
        <label for="caipirinha" class="form-label">Caipirinha de Vinho</label>
        <input type="number" id="caipirinha" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="mojito" class="form-label">Mojito</label>
        <input type="number" id="mojito" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="sex_on_the_beach" class="form-label">Sex on the Beach</label>
        <input type="number" id="sex_on_the_beach" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="gin_tonica" class="form-label">Gin T√¥nica</label>
        <input type="number" id="gin_tonica" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="moscow_mule" class="form-label">Moscow Mule</label>
        <input type="number" id="moscow_mule" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="gim_tropical" class="form-label">Gim Tropical</label>
        <input type="number" id="gim_tropical" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="negroni" class="form-label">Negroni</label>
        <input type="number" id="negroni" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="aperol_spritz" class="form-label">Aperol Spritz</label>
        <input type="number" id="aperol_spritz" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="whisky_sour" class="form-label">Whisky Sour</label>
        <input type="number" id="whisky_sour" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="cosmopolitan" class="form-label">Cosmopolitan</label>
        <input type="number" id="cosmopolitan" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="caipirinha_morango" class="form-label">Caipirinha de Morango</label>
        <input type="number" id="caipirinha_morango" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="caipirinha_limao" class="form-label">Caipirinha de Lim√£o</label>
        <input type="number" id="caipirinha_limao" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="pina_colada" class="form-label">Pi√±a Colada</label>
        <input type="number" id="pina_colada" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="alexander" class="form-label">Alexander</label>
        <input type="number" id="alexander" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="tequila_sour" class="form-label">Tequila Sour</label>
        <input type="number" id="tequila_sour" class="form-input" min="0" value="0" placeholder="0">
      </div>
      <div class="form-group">
        <label for="pink_lady" class="form-label">Pink Lady</label>
        <input type="number" id="pink_lady" class="form-input" min="0" value="0" placeholder="0">
      </div>
    </div>
  </div>

  <!-- Outros Gastos -->
  <div class="card mb-8">
    <div class="card-header">
      <h2 class="card-title">üí∞ Outros Gastos</h2>
      <p class="card-subtitle">Adicione custos extras para o evento</p>
    </div>
    
    <div class="grid grid-cols-4 gap-4">
      <div class="form-group">
        <label for="gelo" class="form-label">Gelo (R$)</label>
        <input type="number" id="gelo" class="form-input" min="0" value="0" placeholder="0.00" step="0.01">
      </div>
      <div class="form-group">
        <label for="copos" class="form-label">Copos (R$)</label>
        <input type="number" id="copos" class="form-input" min="0" value="0" placeholder="0.00" step="0.01">
      </div>
      <div class="form-group">
        <label for="decoracao" class="form-label">Decora√ß√£o (R$)</label>
        <input type="number" id="decoracao" class="form-input" min="0" value="0" placeholder="0.00" step="0.01">
      </div>
      <div class="form-group">
        <label for="carretinha" class="form-label">Carretinha (R$)</label>
        <input type="number" id="carretinha" class="form-input" min="0" value="0" placeholder="0.00" step="0.01">
      </div>
      <div class="form-group">
        <label for="flores" class="form-label">Flores (R$)</label>
        <input type="number" id="flores" class="form-input" min="0" value="0" placeholder="0.00" step="0.01">
      </div>
      <div class="form-group">
        <label for="papelaria" class="form-label">Papelaria (R$)</label>
        <input type="number" id="papelaria" class="form-input" min="0" value="0" placeholder="0.00" step="0.01">
      </div>
      <div class="form-group">
        <label for="funcionarios" class="form-label">Funcion√°rios (R$)</label>
        <input type="number" id="funcionarios" class="form-input" min="0" value="0" placeholder="0.00" step="0.01">
      </div>
      <div class="form-group">
        <label for="alimentacao" class="form-label">Alimenta√ß√£o (R$)</label>
        <input type="number" id="alimentacao" class="form-input" min="0" value="0" placeholder="0.00" step="0.01">
      </div>
      <div class="form-group">
        <label for="canudos" class="form-label">Canudos (R$)</label>
        <input type="number" id="canudos" class="form-input" min="0" value="0" placeholder="0.00" step="0.01">
      </div>
      <div class="form-group">
        <label for="gasolina" class="form-label">Gasolina (R$)</label>
        <input type="number" id="gasolina" class="form-input" min="0" value="0" placeholder="0.00" step="0.01">
      </div>
      <div class="form-group">
        <label for="estrutura_bar" class="form-label">Estrutura Bar (R$)</label>
        <input type="number" id="estrutura_bar" class="form-input" min="0" value="0" placeholder="0.00" step="0.01">
      </div>
    </div>
  </div>

  <!-- Op√ß√µes Adicionais -->
  <div class="card mb-8">
    <div class="card-header">
      <h2 class="card-title">‚öôÔ∏è Op√ß√µes Adicionais</h2>
      <p class="card-subtitle">Configure taxas e servi√ßos extras</p>
    </div>
    
    <div class="form-group">
      <label class="form-checkbox">
        <input type="checkbox" id="incluir_40_percent" onchange="togglePercentual()">
        Incluir Taxa de Servi√ßo (40% do valor total)
      </label>
      <div id="percentual_info" style="display: none;" class="mt-3 p-4 bg-blue-50 border border-blue-200 rounded-lg">
        <div class="flex items-center gap-2 text-blue-700">
          <span>‚ÑπÔ∏è</span>
          <span class="font-medium">Taxa de Servi√ßo:</span>
          <span>40% do valor total ser√° adicionado ao or√ßamento final</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Bot√£o de A√ß√£o -->
  <div class="card">
    <div class="flex justify-center">
      <button onclick="calcularTodosPacotes()" class="btn btn-primary btn-lg">
        üßÆ Calcular Or√ßamento
      </button>
    </div>
  </div>

  <!-- Resultado -->
  <div id="resultado"></div>
</div>

<script src="app.js"></script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('service-worker.js');
    });
  }
</script>

<script>
function togglePercentual() {
  const checkbox = document.getElementById('incluir_40_percent');
  const info = document.getElementById('percentual_info');
  
  if (checkbox.checked) {
    info.style.display = 'block';
    info.classList.add('fade-in');
  } else {
    info.style.display = 'none';
    info.classList.remove('fade-in');
  }
}

const precosPacotes = {
  bronze: { caipirinha:10, mojito:3, sex_on_the_beach:8, gin_tonica:6, moscow_mule:5, gim_tropical:6, negroni:10, aperol_spritz:13, whisky_sour:6, cosmopolitan:6, caipirinha_morango:8, caipirinha_limao:4, pina_colada:6, alexander:13, tequila_sour:17, pink_lady:15, gelo:5, copos:2, decoracao:10, carretinha:50, flores:20, papelaria:10, funcionarios:50, alimentacao:30, canudos:5, gasolina:20, estrutura_bar:100 },
  prata: { caipirinha:25, mojito:7.5, sex_on_the_beach:20, gin_tonica:15, moscow_mule:12.5, gim_tropical:15, negroni:25, aperol_spritz:32.5, whisky_sour:15, cosmopolitan:15, caipirinha_morango:20, caipirinha_limao:10, pina_colada:15, alexander:32.5, tequila_sour:42.5, pink_lady:37.5, gelo:10, copos:5, decoracao:25, carretinha:100, flores:50, papelaria:25, funcionarios:100, alimentacao:60, canudos:10, gasolina:40, estrutura_bar:150 },
  ouro: { caipirinha:30, mojito:9, sex_on_the_beach:24, gin_tonica:18, moscow_mule:15, gim_tropical:18, negroni:30, aperol_spritz:39, whisky_sour:18, cosmopolitan:18, caipirinha_morango:24, caipirinha_limao:12, pina_colada:18, alexander:39, tequila_sour:51, pink_lady:45, gelo:15, copos:8, decoracao:40, carretinha:150, flores:75, papelaria:40, funcionarios:150, alimentacao:90, canudos:15, gasolina:60, estrutura_bar:200 }
};

async function calcularTodosPacotes(){
  try {
    // Valida informa√ß√µes do cliente
    const clienteNome = document.getElementById('clienteNome').value.trim();
    const clienteTelefone = document.getElementById('clienteTelefone').value.trim();
    const clienteCidade = document.getElementById('clienteCidade').value.trim();
    const dataEvento = document.getElementById('dataEvento').value;
    const quantidadeConvidados = document.getElementById('quantidadeConvidados').value;
    const descricaoEvento = document.getElementById('descricaoEvento').value.trim();

  if (!clienteNome || !clienteTelefone || !clienteCidade || !dataEvento || !quantidadeConvidados || !descricaoEvento) {
    showNotification("Por favor, preencha todas as informa√ß√µes do cliente!", "warning");
    return;
  }

    // Coleta todos os dados dos drinks
    const dados = {};
    const todosInputs = document.querySelectorAll('input[type="number"]');
    todosInputs.forEach(input => {
      const valor = parseFloat(input.value) || 0;
      if (valor > 0) {
        dados[input.id] = valor;
      }
    });

  // Verifica se pelo menos um drink foi selecionado
  if (Object.keys(dados).length === 0) {
    showNotification("Por favor, selecione pelo menos um drink!", "warning");
    return;
  }

    // Calcula o valor total do or√ßamento (usando pacote bronze como refer√™ncia)
    let valorTotal = 0;
    Object.keys(dados).forEach(id => {
      const quantidade = dados[id];
      if (['caipirinha', 'mojito', 'sex_on_the_beach', 'gin_tonica', 'moscow_mule', 'gim_tropical', 'negroni', 'aperol_spritz', 'whisky_sour', 'cosmopolitan', 'caipirinha_morango', 'caipirinha_limao', 'pina_colada', 'alexander', 'tequila_sour', 'pink_lady'].includes(id)) {
        const preco = precosPacotes.bronze[id] || 0;
        valorTotal += quantidade * preco;
      } else {
        valorTotal += quantidade;
      }
    });

    // Verifica se deve incluir 40% do valor total
    const incluir40Percent = document.getElementById('incluir_40_percent').checked;
    const taxaServico = incluir40Percent ? valorTotal * 0.4 : 0;
    const valorFinal = valorTotal + taxaServico;

    // Cria o or√ßamento
    const novoOrcamento = {
      cliente: clienteNome,
      telefone: clienteTelefone,
      cidade: clienteCidade,
      data_evento: dataEvento,
      quantidade_convidados: parseInt(quantidadeConvidados),
      valor: parseFloat(valorFinal.toFixed(2)),
      valor_base: parseFloat(valorTotal.toFixed(2)),
      taxa_servico: parseFloat(taxaServico.toFixed(2)),
      incluir_taxa_servico: incluir40Percent,
      descricao: descricaoEvento,
      drinks: dados
    };

    // Envia para a API
    const response = await fetch('/api/orcamentos', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(novoOrcamento)
    });

    const result = await response.json();

    if (!response.ok) {
      showNotification('Erro ao salvar or√ßamento: ' + result.message, 'error');
      return;
    }

    // Salva os dados do or√ßamento para a p√°gina de resultados
    sessionStorage.setItem('orcamentoDados', JSON.stringify(dados));
    sessionStorage.setItem('clienteInfo', JSON.stringify({
      nome: clienteNome,
      telefone: clienteTelefone,
      cidade: clienteCidade,
      data: dataEvento,
      descricao: descricaoEvento,
      incluirTaxaServico: incluir40Percent
    }));
    sessionStorage.setItem('orcamentoId', result.orcamento.id);

    // Mostra notifica√ß√£o de sucesso
    showNotification('Or√ßamento criado com sucesso!', 'success');

    // Limpa os campos
    limparCampos();

    // Redireciona para a p√°gina de resultados
    setTimeout(() => {
      window.location.href = '/resultado';
    }, 1500);

  } catch (error) {
    console.error('Erro ao calcular or√ßamento:', error);
    showNotification('Erro ao processar or√ßamento. Tente novamente.', 'error');
  }
}

function limparCampos() {
  // Limpa informa√ß√µes do cliente
  document.getElementById('clienteNome').value = '';
  document.getElementById('clienteTelefone').value = '';
  document.getElementById('clienteCidade').value = '';
  document.getElementById('dataEvento').value = '';
  document.getElementById('quantidadeConvidados').value = '';
  document.getElementById('descricaoEvento').value = '';
  
  // Limpa op√ß√µes adicionais
  document.getElementById('incluir_40_percent').checked = false;
  document.getElementById('percentual_info').style.display = 'none';

  // Limpa drinks
  const todosInputs = document.querySelectorAll('input[type="number"]');
  todosInputs.forEach(input => {
    input.value = '0';
  });
}

async function logout() {
  try {
    await app.logout();
  } catch (error) {
    console.error('Erro ao fazer logout:', error);
    localStorage.removeItem('usuario');
    window.location.href = '/login';
  }
}




</script>
</body>
</html>
